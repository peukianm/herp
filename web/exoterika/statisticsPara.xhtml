<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="../templates/ui.xhtml">



    <ui:define name="head">
        <style type="text/css">
            .ui-confirm-dialog-severity {
                margin: 0 7px 7px 0;
            }
        </style>

        <script type="text/javascript">
            function handleDialogPatientSubmit(xhr, status, args) {
                if (args.validationFailed) {                                      
                } else {                    
                }
            }
        </script>

    </ui:define> 

    <ui:define name="content">

        <h1 class="title ui-widget-header ui-corner-all">#{bundle.paraStatisticAnalysis}</h1>
        <div class="entry" style="line-height:100%;" >
            <h:form id="searchParaForm">
                <p:messages id="searchParaMsg" autoUpdate="false" severity="error" />		         		   
                <p:panel id="searchParaPanel" header="#{bundle.searchCriteria} " toggleable="false" style="padding:0px ! important; width:auto;white-space: nowrap;margin-bottom: 10px" > 
                    <table  cellpadding="5" class="content1" style="margin-bottom: 10px" >  
                        <tr>
                            <!--<td style="width: auto;white-space: nowrap;"><h:outputLabel value="{bundle.assertionPeriod}:" style="font-weight: bold" /></td>
                            <td style="width: auto;white-space: nowrap;" >                                                            
                                <p:selectOneMenu value="{searchParaBean.searchByAssertion}" converter="AssertionConverter" id="selectAssertion" >						 
                                    <f:selectItem itemLabel="" itemValue=""  />
                                    <f:selectItems value="{searchParaBean.assertions}" var="assertion" itemLabel="{assertion.exPeriod.name}-{assertion.exAssertionType.name}" itemValue="{assertion}"   />						                                                                   
                                </p:selectOneMenu>

                            </td> -->
                            
                            <td style="width: 1px;white-space: nowrap;"> <h:outputLabel value="#{bundle.period}:"  style="font-weight: bold" /></td>
                            <td style="width: 1px;white-space: nowrap;">
                                <p:selectOneMenu value="#{searchParaBean.searchByPeriod}" converter="pc" >						 
                                    <f:selectItem itemLabel="" itemValue=""  />
                                    <f:selectItems value="#{searchParaBean.periods}" var="period" itemLabel="#{period.name}" itemValue="#{period}"   />						     
                                </p:selectOneMenu>	
                            </td>
                            
                            <td style="width: auto;white-space: nowrap;"><h:outputLabel value="#{bundle.assertionType}:" style="font-weight: bold" /></td>
                            <td style="width: auto;white-space: nowrap;" >                                                            
                                <p:selectOneMenu value="#{searchParaBean.searchByAssertionType}" converter="AssertionTypeConverter" id="selectAssertion" >						 
                                    <f:selectItem itemLabel="" itemValue=""  />                                    
                                    <f:selectItems value="#{applicationListBean.assertionTypes}" var="asstype" itemLabel="#{asstype.name}" itemValue="#{asstype}"   /> 
                                </p:selectOneMenu>

                            </td>
                            
                            <td style="width: auto;white-space: nowrap;"> <h:outputLabel value="#{bundle.dateType}:"  style="font-weight: bold" /></td>
                            <td style="width: auto;white-space: nowrap;">
                                <p:selectOneMenu value="#{searchParaBean.searchByType}" converter="TypeConverter" >						 
                                    <f:selectItem itemLabel="" itemValue=""  />
                                    <f:selectItems value="#{applicationListBean.types}" var="tp" itemLabel="#{tp.name}" itemValue="#{tp}"   />						     
                                </p:selectOneMenu>	
                            </td>
                            
                        </tr>
                        <tr>
                            <td><h:outputLabel value="#{bundle.exam}:"  style="font-weight: bold"  /></td>
                            <td colspan="5">                                    
                                <p:autoComplete queryDelay="500" scrollHeight="350"   id="nameComplete" value="#{searchParaBean.selectedExamByName}" completeMethod="#{paraAction.completeNameExam}" size="100"  
                                                  var="exam" itemLabel="#{exam.name} #{exam.code}" itemValue="#{exam}" 
                                                  converter="ExamConverter" forceSelection="true">  
                                    <p:ajax event="itemSelect" listener="#{paraAction.autocompleteNameSelectExam}"     />  
                                </p:autoComplete><br/>
                                <h:outputText rendered="#{searchParaBean.searchByExam != null}"  
                                              value="#{bundle.exam}: #{searchParaBean.searchByExam.name}"  />
                                
                            </td>                              
                        </tr>

                        <tr>                            
                            <td style="width: auto;white-space: nowrap;"><h:outputLabel value="#{bundle.exeDate} #{bundle.from}:" style="font-weight: bold"  /></td>
                            <td style="width: auto;white-space: nowrap;"> 
                                <p:calendar locale="el" size="12"  readonlyInput="true"  navigator="true" showOn="button" 
                                            pattern="dd/MM/yyyy" value="#{searchParaBean.searchFromExecutionDate}" id="searchFromExecutionDate" /> 

                            </td>
                            
                            <td style="width: auto;white-space: nowrap;"><h:outputLabel value="#{bundle.exeDate} #{bundle.to}:"  style="font-weight: bold"  /></td>
                            <td colspan="3"> 
                                <p:calendar locale="el" size="12"  readonlyInput="true"  navigator="true" showOn="button" 
                                            pattern="dd/MM/yyyy" value="#{searchParaBean.searchToExecutionDate}" id="searchToExecutionDate"/> 

                            </td>                            
                        </tr>
                        
                    </table>
                    <p:commandButton value="#{bundle.search}" action="#{paraAction.statisticsParaAction()}" update="searchParaForm"  />
                    <p:commandButton  value="#{bundle.reset}" action="#{paraAction.resetSearchPara}"  ajax="false" />
                </p:panel>  



                <p:panel id="exams" header="#{bundle.searchResults}"  toggleable="false" style="padding:0px ! important; width:100%; margin-bottom: 10px" > 


                    <p:dataTable id="paraResults" var="statistic" value="#{searchParaBean.statisticsData}" selection="#{searchParaBean.selectedStatisticParaResult}" widgetVar="paraResultss"
                                 paginator="true" rows="10" emptyMessage="#{bundle.noRecordsFound}" rowIndexVar="tt"  rowKey="#{statistic}" 
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                 rowsPerPageTemplate="10,20,50" >  



                        <p:column headerText="A/A" style="width:3%">  
                            <h:outputText value="#{tt+1}" />  
                        </p:column>  


                        <p:column headerText="#{bundle.name}" sortBy="#{statistic.exam.name}" style="width:57%">  
                            <h:outputText value="#{statistic.exam.name}" />  
                        </p:column>

                        <p:column headerText="#{bundle.code}" sortBy="#{statistic.exam.code}" style="width:6%; white-space: normal;">                                                            
                            <h:outputText value="#{statistic.exam.code}" />                                                           
                        </p:column>  
                        
                        <p:column headerText="#{bundle.countExams}" sortBy="#{statistic.countExams}" style="width:4%; white-space: normal;">                                                            
                            <h:outputText value="#{statistic.countExams}" />                                                           
                        </p:column>  
                        
                        <p:column headerText="#{bundle.totalAmountWithoutCalcPart}" sortBy="#{statistic.amount}"  style="width: 15%; white-space: normal;">  
                            <h:outputText value="#{statistic.amount}" converter="DoubleConverter"/>  
                        </p:column> 

                        <p:column headerText="#{bundle.totalAmountCalcPart}" sortBy="#{statistic.netAmount}" style="width: 15%; white-space: normal;">  
                            <h:outputText value="#{statistic.netAmount}" converter="DoubleConverter"/>  
                        </p:column> 

                    </p:dataTable>



                    <h:commandLink rendered="#{searchParaBean.statisticsData.size() >0}">  
                        <p:graphicImage value="/images/excel.png" /> <h:outputText  style="color:blue;text-decoration: underline;font-weight:bold;" value="#{bundle.excelExport}" /> 
                        <p:dataExporter    type="xls" target="paraResults" fileName="statistics"/>  
                    </h:commandLink>  

                </p:panel>

            </h:form> 

        </div>        
    </ui:define>
</ui:composition>